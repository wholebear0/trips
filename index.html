<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trips Toggle View</title>

<link href="https://fonts.googleapis.com/css2?family=Playwrite+NZ+Basic:wght@400;600&family=Nunito:wght@300;400;600&display=swap" rel="stylesheet">

<style>
html, body { margin:0; padding:0; font-family:sans-serif; background:transparent; color:#eaeaea; }

/* Header */
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 20px;
}
.header .title { font-family:'Playwrite NZ Basic', cursive; font-size:22px; color:white; }
button.toggle-view { padding:8px 16px; font-size:14px; border-radius:6px; border:none; background:#1a1a1a; color:white; cursor:pointer; }

/* CARDS */
#cardsView { overflow-x:hidden; padding:10px 20px; }
.entry { display:flex; flex-direction:row; width:100%; height:50vw; max-height:500px; margin-bottom:20px; }
.entry-sidebar { width:25%; display:flex; flex-direction:column; background:rgba(0,0,0,0.6); }
.entry-sidebar .top-half { flex:1; padding:15px; color:white; font-family:'Nunito', sans-serif; }
.entry-sidebar .top-half p { margin:5px 0; }
.entry-sidebar .top-half .title { font-family:'Playwrite NZ Basic', cursive; font-size:20px; font-weight:600; margin-bottom:8px; }
.entry-sidebar .bottom-half { flex:1; }
.entry-main { width:75%; position:relative; }
.entry-image {
  width:100%;
  height:100%;
  background-size:cover;
  background-position:center;
  border-radius:0 8px 8px 0;
  will-change: transform;
}

/* MOBILE */
@media (max-width:768px){
  .entry { flex-direction:column; height:auto; }
  .entry-sidebar { display:none; }

  .mobile-entry { display:flex; flex-direction:column; width:100%; margin-bottom:20px; }
  .entry-main, .mobile-box { width:100%; margin:0; padding:0; box-sizing:border-box; }
  .entry-image { height:44vw; max-height:none; border-radius:0; } 
  .mobile-box { display:block; background:#1a1a1a; color:white; padding:12px 14px; font-size:13px; line-height:1.3; font-family:'Nunito',sans-serif; }
  .mobile-box p { margin:3px 0; }
  .mobile-box .title { font-family:'Playwrite NZ Basic'; font-size:18px; font-weight:600; margin-bottom:6px; }

  .pagination { position:fixed; bottom:0; left:0; width:100%; background:#111; padding:10px 0; display:flex; justify-content:center; z-index:100; overflow-x:auto; }
  .pagination button { margin:0 3px; padding:6px 12px; border:none; border-radius:4px; background:#1a1a1a; color:white; cursor:pointer; white-space:nowrap; flex-shrink:0; }
  .pagination button.active { background:#6188e6; }
}

@media (min-width:769px){ 
  .mobile-box { display:none; }
  .pagination { text-align:center; margin:15px 0; }
  .pagination button { margin:2px; padding:6px 12px; border:none; border-radius:4px; background:#1a1a1a; color:white; cursor:pointer; }
  .pagination button.active { background:#6188e6; }
}
</style>
</head>
<body>

<div class="header">
  <div class="title">Most Recent Adventures</div>
  <button class="toggle-view">Switch to List View</button>
</div>

<div id="cardsView"></div>
<div id="listView" style="display:none; padding:10px 20px;"></div>

<script>
let allItems=[];
const MOBILE_LIMIT=15;
const DESKTOP_LIMIT=15;
let mobilePage=0;
let desktopPage=0;

/* UTILS */
function formatDate(d){
  const dt=new Date(d);
  return isNaN(dt)?d:dt.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
}
function generatePageUrl(title){
  return `https://sites.google.com/view/wholebear/${title.toLowerCase().replace(/[^\w\s-]/g,'').replace(/\s+/g,'-')}`;
}

/* LOAD DATA */
async function loadData(){
  const res=await fetch('https://script.google.com/macros/s/AKfycbweollfSW_IlQr6nka0s77-WPu4sIdIDDpmq0Z9NV0egq0c-8dVcO4nevotzZM6jA4T/exec');
  const data=await res.json();
  allItems=data.cardItems.sort((a,b)=>new Date(b.date)-new Date(a.date));
  renderCards();
}

/* RENDER CARDS */
function renderCards(){
  const container=document.getElementById('cardsView');
  const isMobile=window.innerWidth<=768;
  container.innerHTML='';

  let pageIndex=isMobile?mobilePage:desktopPage;
  let limit=isMobile?MOBILE_LIMIT:DESKTOP_LIMIT;

  const start=pageIndex*limit;
  const itemsToShow=allItems.slice(start,start+limit);

  itemsToShow.forEach(item=>{
    if(isMobile){
      container.innerHTML+=`
        <div class="mobile-entry">
          <div class="entry-main">
            <a href="${generatePageUrl(item.title)}" target="_blank">
              <div class="entry-image" data-bg="${item.imageUrl}"></div>
            </a>
          </div>
          <div class="mobile-box">
            <p class="title">${item.title}</p>
            <p><strong>Date:</strong> ${formatDate(item.date)}</p>
            <p><strong>Miles:</strong> ${item.miles}</p>
            <p><strong>Elevation Gain:</strong> ${item.elevationgain}</p>
            <p><strong>Type:</strong> ${item.type}</p>
            <p><strong>Where:</strong> ${item.area}</p>
          </div>
        </div>
      `;
    } else {
      container.innerHTML+=`
        <div class="entry">
          <div class="entry-sidebar">
            <div class="top-half">
              <p class="title">${item.title}</p>
              <p><strong>Date:</strong> ${formatDate(item.date)}</p>
              <p><strong>Miles:</strong> ${item.miles}</p>
              <p><strong>Elevation Gain:</strong> ${item.elevationgain}</p>
              <p><strong>Type:</strong> ${item.type}</p>
              <p><strong>Where:</strong> ${item.area}</p>
            </div>
          </div>
          <div class="entry-main">
            <a href="${generatePageUrl(item.title)}" target="_blank">
              <div class="entry-image" data-bg="${item.imageUrl}"></div>
            </a>
          </div>
        </div>
      `;
    }
  });

  lazyLoadBackgrounds();
}

/* LAZY LOAD BACKGROUNDS */
function lazyLoadBackgrounds(){
  const images=document.querySelectorAll('.entry-image');

  const observer=new IntersectionObserver((entries)=>{
    entries.forEach(entry=>{
      if(entry.isIntersecting){
        const el=entry.target;
        const bg=el.getAttribute('data-bg');
        if(bg){
          el.style.backgroundImage=`url('${bg}')`;
          el.removeAttribute('data-bg');
        }
        observer.unobserve(el);
      }
    });
  },{ rootMargin:'200px' });

  images.forEach(img=>observer.observe(img));
}

/* TOGGLE */
document.querySelector('.toggle-view').onclick=()=>{
  const cards=document.getElementById('cardsView');
  const list=document.getElementById('listView');
  if(cards.style.display!=='none'){
    cards.style.display='none';
    list.style.display='block';
  }else{
    cards.style.display='block';
    list.style.display='none';
  }
};

window.addEventListener('resize',renderCards);

loadData();
</script>

</body>
</html>
